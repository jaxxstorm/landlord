basePath: /v1
definitions:
  models.ComputeConfigDiscoveryResponse:
    properties:
      defaults:
        additionalProperties: true
        description: Defaults is an optional defaults object for compute_config.
        type: object
      provider:
        description: Provider is the active compute provider identifier (e.g., "docker").
        type: string
      schema:
        additionalProperties: true
        description: Schema is the JSON Schema (draft 2020-12) for compute_config.
        type: object
    type: object
  models.CreateTenantRequest:
    properties:
      annotations:
        additionalProperties:
          type: string
        description: Annotations are key-value pairs for metadata
        type: object
      compute_config:
        additionalProperties: true
        description: |-
          ComputeConfig is provider-specific configuration (Docker, ECS, K8s, etc.)
          Required and validated by the active compute provider
        type: object
      labels:
        additionalProperties:
          type: string
        description: Labels are key-value pairs for organizing tenants
        type: object
      name:
        description: Name is the unique human-friendly name for the tenant
        maxLength: 255
        minLength: 1
        type: string
    required:
    - compute_config
    - name
    type: object
  models.ErrorResponse:
    properties:
      details:
        description: Details provides additional context about the error
        items:
          type: string
        type: array
      error:
        description: Error is the error message
        type: string
      request_id:
        description: RequestID is the correlation ID from the request context
        type: string
    type: object
  models.ListTenantsResponse:
    properties:
      limit:
        description: Number of items per page
        type: integer
      offset:
        description: Starting position
        type: integer
      tenants:
        description: Tenants is the array of tenant resources
        items:
          $ref: '#/definitions/models.TenantResponse'
        type: array
      total:
        description: Pagination metadata
        type: integer
    type: object
  models.TenantResponse:
    properties:
      annotations:
        additionalProperties:
          type: string
        description: Annotations are key-value pairs for metadata
        type: object
      compute_config:
        additionalProperties: true
        description: ComputeConfig is the provider-specific compute configuration
        type: object
      created_at:
        description: CreatedAt is when the tenant was first created
        type: string
      desired_config:
        additionalProperties: true
        description: DesiredConfig is tenant-specific configuration
        type: object
      id:
        description: ID is the internal database identifier (UUID)
        type: string
      labels:
        additionalProperties:
          type: string
        description: Labels are key-value pairs for filtering and grouping
        type: object
      name:
        description: Name is the user-facing stable identifier
        type: string
      observed_config:
        additionalProperties: true
        description: ObservedConfig is the actual configuration applied to running
          resources
        type: object
      observed_resource_ids:
        additionalProperties:
          type: string
        description: ObservedResourceIDs contains provider-specific resource identifiers
        type: object
      status:
        description: Status represents where the tenant is in its lifecycle
        type: string
      status_message:
        description: StatusMessage provides human-readable context about current status
        type: string
      updated_at:
        description: UpdatedAt is when the tenant was last modified
        type: string
      version:
        description: Version is the concurrency control version
        type: integer
      workflow_execution_id:
        description: WorkflowExecutionID is the ID of the current or last workflow
          execution
        type: string
      workflow_error_message:
        description: WorkflowErrorMessage is the latest workflow error message
        type: string
      workflow_retry_count:
        description: WorkflowRetryCount is the number of workflow retry attempts
        type: integer
      workflow_sub_state:
        description: WorkflowSubState is the provider-agnostic execution sub-state
        type: string
    type: object
  models.UpdateTenantRequest:
    properties:
      annotations:
        additionalProperties:
          type: string
        description: Annotations are key-value pairs for metadata
        type: object
      compute_config:
        additionalProperties: true
        description: |-
          ComputeConfig is provider-specific configuration for updates
          Required and validated by the active compute provider
        type: object
      labels:
        additionalProperties:
          type: string
        description: Labels are key-value pairs for organizing tenants
        type: object
      name:
        description: Name is the updated tenant name
        type: string
    required:
    - compute_config
    type: object
info:
  contact: {}
  description: HTTP API for landlord application
  title: Landlord API
  version: "1.0"
paths:
  /v1/compute/config:
    get:
      description: Returns the active compute provider and its compute_config schema (and defaults if available)
      produces:
      - application/json
      responses:
        "200":
          description: Compute config discovery
          schema:
            $ref: '#/definitions/models.ComputeConfigDiscoveryResponse'
        "500":
          description: Compute provider not configured
          schema:
            $ref: '#/definitions/models.ErrorResponse'
      summary: Get compute config discovery
      tags:
      - compute
  /v1/docs:
    get:
      description: Serves the interactive API documentation using Redoc
      produces:
      - text/html
      responses:
        "200":
          description: API documentation HTML page
      summary: API documentation
      tags:
      - documentation
  /v1/swagger.json:
    get:
      description: Returns the OpenAPI 3.0 specification for the API
      produces:
      - application/json
      responses:
        "200":
          description: OpenAPI specification
          schema:
            additionalProperties: true
            type: object
      summary: OpenAPI specification
      tags:
      - documentation
  /v1/tenants:
    get:
      description: Returns a paginated list of tenants
      parameters:
      - description: Maximum number of results (default 50)
        in: query
        name: limit
        type: integer
      - description: Number of results to skip (default 0)
        in: query
        name: offset
        type: integer
      - description: Include archived tenants in results
        in: query
        name: include_deleted
        type: boolean
      - description: Filter by workflow sub-state (comma-separated)
        in: query
        name: workflow_sub_state
        type: string
      - description: Filter tenants with workflow errors
        in: query
        name: has_workflow_error
        type: boolean
      - description: Minimum workflow retry count
        in: query
        name: min_retry_count
        type: integer
      produces:
      - application/json
      responses:
        "200":
          description: List of tenants
          schema:
            $ref: '#/definitions/models.ListTenantsResponse'
        "400":
          description: Invalid pagination parameters
          schema:
            $ref: '#/definitions/models.ErrorResponse'
        "500":
          description: Internal server error
          schema:
            $ref: '#/definitions/models.ErrorResponse'
      summary: List all tenants
      tags:
      - tenants
    post:
      consumes:
      - application/json
      description: Creates a new tenant with provided configuration
      parameters:
      - description: Tenant creation request
        in: body
        name: body
        required: true
        schema:
          $ref: '#/definitions/models.CreateTenantRequest'
      produces:
      - application/json
      responses:
        "201":
          description: Tenant created successfully
          schema:
            $ref: '#/definitions/models.TenantResponse'
        "400":
          description: Invalid request or validation error
          schema:
            $ref: '#/definitions/models.ErrorResponse'
        "409":
          description: Tenant name already exists
          schema:
            $ref: '#/definitions/models.ErrorResponse'
        "500":
          description: Internal server error
          schema:
            $ref: '#/definitions/models.ErrorResponse'
      summary: Create a new tenant
      tags:
      - tenants
  /v1/tenants/{id}:
    delete:
      description: Deletes a specific tenant resource
      parameters:
      - description: Tenant identifier (UUID or name)
        in: path
        name: id
        required: true
        type: string
      responses:
        "200":
          description: Tenant deleted
          schema:
            $ref: '#/definitions/models.TenantResponse'
        "202":
          description: Tenant deletion initiated
          schema:
            $ref: '#/definitions/models.TenantResponse'
        "400":
          description: Invalid tenant identifier format
          schema:
            $ref: '#/definitions/models.ErrorResponse'
        "404":
          description: Tenant not found
          schema:
            $ref: '#/definitions/models.ErrorResponse'
        "500":
          description: Internal server error
          schema:
            $ref: '#/definitions/models.ErrorResponse'
      summary: Delete a tenant
      tags:
      - tenants
    get:
      description: Retrieves a specific tenant resource
      parameters:
      - description: Tenant identifier (UUID or name)
        in: path
        name: id
        required: true
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: Tenant found
          schema:
            $ref: '#/definitions/models.TenantResponse'
        "400":
          description: Invalid tenant identifier format
          schema:
            $ref: '#/definitions/models.ErrorResponse'
        "404":
          description: Tenant not found
          schema:
            $ref: '#/definitions/models.ErrorResponse'
        "500":
          description: Internal server error
          schema:
            $ref: '#/definitions/models.ErrorResponse'
      summary: Get a tenant by ID
      tags:
      - tenants
    put:
      consumes:
      - application/json
      description: |-
        Updates properties of an existing tenant. Changes to the `desired_config` field will trigger automatic workflow restart if the workflow is in a degraded state (backing-off). 
        
        **Config Change Behavior:**
        - If workflow is backing-off due to config errors, updating config will stop the degraded workflow and start a new one with the updated configuration
        - If workflow is running successfully, config changes will NOT interrupt it (changes take effect on next workflow trigger)
        - Config hash is computed and stored for change detection
        
        The update is asynchronous - the API returns immediately after validation, and the controller handles workflow restart in the background (typically within 30 seconds based on reconciliation interval).
      parameters:
      - description: Tenant identifier (UUID or name)
        in: path
        name: id
        required: true
        type: string
      - description: Tenant update request
        in: body
        name: body
        required: true
        schema:
          $ref: '#/definitions/models.UpdateTenantRequest'
      produces:
      - application/json
      responses:
        "200":
          description: Tenant updated successfully
          schema:
            $ref: '#/definitions/models.TenantResponse'
        "400":
          description: Invalid request or validation error
          schema:
            $ref: '#/definitions/models.ErrorResponse'
        "404":
          description: Tenant not found
          schema:
            $ref: '#/definitions/models.ErrorResponse'
        "500":
          description: Internal server error
          schema:
            $ref: '#/definitions/models.ErrorResponse'
      summary: Update a tenant
      tags:
      - tenants
  /v1/tenants/{id}/archive:
    post:
      description: Archives a tenant by removing compute resources and retaining the
        record
      parameters:
      - description: Tenant identifier (UUID or name)
        in: path
        name: id
        required: true
        type: string
      responses:
        "200":
          description: Tenant already archived
          schema:
            $ref: '#/definitions/models.TenantResponse'
        "202":
          description: Tenant archival initiated
          schema:
            $ref: '#/definitions/models.TenantResponse'
        "400":
          description: Invalid tenant identifier format
          schema:
            $ref: '#/definitions/models.ErrorResponse'
        "404":
          description: Tenant not found
          schema:
            $ref: '#/definitions/models.ErrorResponse'
        "409":
          description: Invalid state transition
          schema:
            $ref: '#/definitions/models.ErrorResponse'
        "500":
          description: Internal server error
          schema:
            $ref: '#/definitions/models.ErrorResponse'
      summary: Archive a tenant
      tags:
      - tenants
  /health:
    get:
      description: Returns server health status
      produces:
      - application/json
      responses:
        "200":
          description: Server health status
          schema:
            additionalProperties:
              type: string
            type: object
      summary: Health check
      tags:
      - health
  /ready:
    get:
      description: Returns server readiness status and dependency health
      produces:
      - application/json
      responses:
        "200":
          description: Server is ready
          schema:
            additionalProperties: true
            type: object
        "503":
          description: Server is unavailable
          schema:
            additionalProperties: true
            type: object
      summary: Readiness check
      tags:
      - health
schemes:
- http
- https
swagger: "2.0"
